[tools]
act = "latest"
goreleaser = "latest"
"ubi:golangci/golangci-lint" = "latest"
"go:golang.org/x/tools/cmd/goimports" = "latest"
"ubi:air-verse/air" = "latest"
node = "latest"
"npm:@modelcontextprotocol/inspector" = "latest"
"pipx:pre-commit" = "latest"

[tasks.setup]
run = "pre-commit install"
description = "Install pre-commit hooks"

[tasks.fmt]
run = "gofmt -l -w -s ./"

[tasks.vet]
run = "go vet ./..."

[tasks.lint]
depends = ["vet", "fmt"]
run = "mise exec -- golangci-lint run --modules-download-mode readonly --timeout=10m"

[tasks.test]
run = "go test -race ./..."
description = "Run unit tests"

[tasks."test:integration"]
run = "go test -race -tags=integration ./internal/integration/..."
description = "Run integration tests (requires network)"

[tasks."test:e2e-ts"]
run = "cd e2e-ts && npm install && npx vitest run"
description = "Run TypeScript e2e tests (requires Docker)"

[tasks."test:all"]
depends = ["test", "test:integration", "test:e2e-ts"]
description = "Run all tests (unit, integration, e2e)"

[tasks."test:cover"]
run = "go test -race -coverprofile=coverage.out ./... && go tool cover -html=coverage.out -o coverage.html"
description = "Run tests with coverage report"

[tasks.build]
run = "go build -o tmp/mcp-helm ./cmd/mcp-helm"

[tasks.dev]
run = "air"

[tasks.inspector]
run = "mcp-inspector --config inspector-config.json --server mcp-helm"
